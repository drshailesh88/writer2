{
  "master": {
    "tasks": [
      {
        "id": "1",
        "title": "Project Foundation & Infrastructure Setup",
        "description": "Bootstrap the Next.js 14+ project with App Router, configure Convex database, integrate Clerk authentication, set up Vercel deployment pipeline, and establish the base project structure following the constitution's tech stack requirements.",
        "details": "1. Initialize Next.js 14+ with App Router using `npx create-next-app@latest` with TypeScript, Tailwind CSS, and App Router enabled.\n2. Install and configure Convex: `npm install convex`, run `npx convex dev`, set up `convex/` directory with schema definitions.\n3. Integrate Clerk: Install `@clerk/nextjs`, configure middleware for route protection, set up Google OAuth and email/password providers.\n4. Install shadcn/ui: `npx shadcn-ui@latest init`, configure with Tailwind.\n5. Set up environment variables structure (.env.local) for: CONVEX_DEPLOYMENT, NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY, CLERK_SECRET_KEY, etc.\n6. Create base folder structure: `app/`, `components/`, `lib/`, `hooks/`, `types/`.\n7. Configure TypeScript strict mode in tsconfig.json.\n8. Set up Vercel project and link to GitHub repository.\n9. Create base layout.tsx with Clerk providers and responsive navigation shell.\n10. Test: Verify authentication flow works, database connection succeeds, and deployment to Vercel preview environment succeeds.",
        "testStrategy": "Playwright E2E test: (1) User can sign up with Google OAuth and land on dashboard, (2) User can sign out, (3) Protected routes redirect to sign-in, (4) Convex connection verified by writing/reading a test record. Verify TypeScript compiles with zero errors. Verify Vercel preview deployment succeeds.",
        "priority": "high",
        "dependencies": [],
        "status": "done",
        "subtasks": [
          {
            "id": 1,
            "title": "Initialize Next.js 14+ project with App Router and TypeScript",
            "description": "Bootstrap the Next.js application using create-next-app with TypeScript, Tailwind CSS, and App Router configuration. Set up strict TypeScript compiler options and base folder structure.",
            "dependencies": [],
            "details": "Run `npx create-next-app@latest . --typescript --tailwind --app --no-src-dir --import-alias '@/*'` to initialize in current directory. Configure tsconfig.json with strict mode enabled. Create base folder structure: `app/`, `components/`, `lib/`, `hooks/`, `types/`. Install @types/node and @types/react. Verify Next.js dev server runs successfully on localhost:3000.",
            "status": "done",
            "testStrategy": "Verify TypeScript compiles with zero errors using `npm run build`. Confirm dev server starts with `npm run dev`. Check that tsconfig.json has strict:true and all base directories exist.",
            "parentId": "undefined",
            "updatedAt": "2026-02-07T00:23:31.349Z"
          },
          {
            "id": 2,
            "title": "Install and configure Convex database with initial schema structure",
            "description": "Set up Convex as the TypeScript-only database. Install Convex SDK, initialize the project, configure environment variables, and create the convex/ directory with placeholder schema file ready for Task 2 schema implementation.",
            "dependencies": [
              1
            ],
            "details": "Install: `npm install convex`. Run `npx convex dev` to create Convex project and get deployment URL. Add CONVEX_DEPLOYMENT and NEXT_PUBLIC_CONVEX_URL to .env.local. Create `convex/schema.ts` with empty schema placeholder. Create `convex/tsconfig.json` for Convex function compilation. Set up ConvexProvider in Next.js app layout. Test connection by creating a simple test query function in `convex/test.ts`.",
            "status": "done",
            "testStrategy": "Verify Convex connection by running a test query from the frontend that writes and reads a record. Confirm `npx convex dev` runs without errors. Check that .env.local has CONVEX_DEPLOYMENT and NEXT_PUBLIC_CONVEX_URL variables set.",
            "parentId": "undefined",
            "updatedAt": "2026-02-07T00:24:27.261Z"
          },
          {
            "id": 3,
            "title": "Integrate Clerk authentication with Google OAuth and email/password",
            "description": "Install and configure Clerk for authentication. Set up middleware for route protection, configure Google OAuth and email/password providers, and wrap the Next.js app with Clerk providers.",
            "dependencies": [
              1
            ],
            "details": "Install: `npm install @clerk/nextjs`. Create Clerk application at clerk.com dashboard. Configure Google OAuth and email/password in Clerk dashboard. Add NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY and CLERK_SECRET_KEY to .env.local. Create `middleware.ts` at root with publicRoutes config (/, /api/webhooks/clerk). Wrap app in `app/layout.tsx` with ClerkProvider. Create sign-in and sign-up pages at `app/sign-in/[[...sign-in]]/page.tsx` and `app/sign-up/[[...sign-up]]/page.tsx`. Set up Clerk-Convex integration for user sync.",
            "status": "done",
            "testStrategy": "Playwright E2E test: (1) User can navigate to sign-up page, (2) User can sign up with email/password and land on dashboard route, (3) User can sign out, (4) Protected route /dashboard redirects unauthenticated users to sign-in, (5) Google OAuth button is visible and clickable.",
            "parentId": "undefined",
            "updatedAt": "2026-02-07T00:28:21.169Z"
          },
          {
            "id": 4,
            "title": "Install shadcn/ui and configure Tailwind CSS theming",
            "description": "Set up shadcn/ui component library with Tailwind CSS configuration. Initialize shadcn/ui CLI, configure theme colors for professional academic feel, and install core components needed for initial layouts.",
            "dependencies": [
              1
            ],
            "details": "Run `npx shadcn-ui@latest init` with default configuration. Select 'New York' style, neutral color scheme. Configure tailwind.config.js with custom colors for academic theme (professional blues, clean grays). Set up components.json. Install initial shadcn components: `npx shadcn-ui@latest add button card input label dropdown-menu navigation-menu`. Create `lib/utils.ts` with cn() helper. Verify mobile-responsive breakpoints are configured (sm:640px, md:768px, lg:1024px, xl:1280px).",
            "status": "done",
            "testStrategy": "Create a test page with Button, Card, and Input components from shadcn/ui. Verify they render correctly with proper styling. Test responsive behavior at 375px and 1280px viewport widths. Confirm Tailwind CSS classes apply correctly.",
            "parentId": "undefined",
            "updatedAt": "2026-02-07T00:28:29.522Z"
          },
          {
            "id": 5,
            "title": "Set up Vercel deployment pipeline and create base app layout",
            "description": "Link project to Vercel for deployment, configure environment variables, set up GitHub integration, and create the base app layout with Clerk providers and responsive navigation shell. Deploy to Vercel preview environment.",
            "dependencies": [
              2,
              3,
              4
            ],
            "details": "Link GitHub repository at github.com/drshailesh88/writer2. Install Vercel CLI: `npm i -g vercel`. Run `vercel link` to connect project. Add all environment variables to Vercel dashboard: CONVEX_DEPLOYMENT, NEXT_PUBLIC_CONVEX_URL, NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY, CLERK_SECRET_KEY, DEEPSEEK_API_KEY. Create `app/layout.tsx` with ClerkProvider, ConvexProviderWithClerk, and base HTML structure. Create `app/dashboard/layout.tsx` with responsive navigation (mobile hamburger menu, desktop sidebar). Add metadata (title, description, icons). Deploy with `vercel --prod`. Verify preview deployment succeeds.",
            "status": "done",
            "testStrategy": "Playwright E2E test on Vercel preview URL: (1) Landing page loads successfully, (2) Sign-up flow completes and redirects to dashboard, (3) Dashboard layout renders with navigation, (4) Mobile menu works on 375px viewport. Verify all environment variables are accessible in deployed environment.",
            "parentId": "undefined",
            "updatedAt": "2026-02-07T00:30:41.661Z"
          }
        ],
        "updatedAt": "2026-02-07T00:30:41.661Z"
      },
      {
        "id": "2",
        "title": "Convex Database Schema Implementation",
        "description": "Implement the complete Convex schema for all core entities (Users, Documents, Papers, Collections, Citations, Plagiarism Checks, AI Detection Checks, Deep Research Reports, Learn Mode Sessions, Subscriptions) with proper indexes and relationships.",
        "details": "1. In `convex/schema.ts`, define all tables using Convex's defineSchema and defineTable:\n   - users: clerkId (indexed), email, name, institution, specialization, subscriptionStatus, subscriptionExpiry, razorpayCustomerId, plagiarismChecksUsed, aiDetectionChecksUsed, deepResearchUsed, timestamps\n   - documents: userId (indexed), title, content (JSON), mode, currentStage, outlineData, approvedPapers, citationStyle, wordCount, status, timestamps\n   - papers: userId (indexed), collectionId, externalId (indexed), source, title, authors (array), journal, year, abstract, doi, url, pdfFileId, isOpenAccess, metadata (JSON), timestamps\n   - collections: userId (indexed), name, description, timestamps\n   - citations: documentId (indexed), paperId, sectionName, position, citationText\n   - plagiarismChecks: userId (indexed), documentId, inputText, wordCount, overallSimilarity, sources (JSON), copyleaksScanId, status, timestamps\n   - aiDetectionChecks: userId (indexed), documentId, inputText, wordCount, overallAiScore, sentenceResults (JSON), copyleaksScanId, status, timestamps\n   - deepResearchReports: userId (indexed), topic, report, citedPapers (JSON), status, timestamps\n   - learnModeSessions: userId (indexed), documentId (indexed), currentStage, conversationHistory (JSON), feedbackGiven (JSON), timestamps\n   - subscriptions: userId (indexed), razorpaySubscriptionId, planType, status, currentPeriodStart, currentPeriodEnd, timestamps\n2. Add indexes for common queries (userId on all tables, documentId where relevant, status fields).\n3. Create Convex mutations and queries for CRUD operations on each table.\n4. Set up Convex file storage configuration for PDF uploads.\n5. Implement helper functions for subscription tier checking and usage limit enforcement.",
        "testStrategy": "Unit tests for each Convex function: Create, read, update, delete operations for each entity. Test index performance with mock data (1000+ records). Verify file storage works by uploading/retrieving a test PDF. Playwright E2E: Create a user via Clerk, verify user record created in Convex users table with correct clerkId mapping.",
        "priority": "high",
        "dependencies": [
          "1"
        ],
        "status": "done",
        "subtasks": [
          {
            "id": 1,
            "title": "Extend Convex schema with all core entity tables",
            "description": "Expand convex/schema.ts to define all 9 remaining tables (documents, papers, collections, citations, plagiarismChecks, aiDetectionChecks, deepResearchReports, learnModeSessions, subscriptions) with proper field types, indexes, and relationships.",
            "dependencies": [],
            "details": "In convex/schema.ts, add defineTable for:\n- documents: userId (v.id('users'), indexed), title (v.string()), content (v.optional(v.any()) for JSON), mode (v.union('learn'|'draft')), currentStage (v.optional(v.string())), outlineData (v.optional(v.any())), approvedPapers (v.optional(v.array(v.string()))), citationStyle (v.union('vancouver'|'apa'|'ama'|'chicago')), wordCount (v.number()), status (v.union('draft'|'archived')), createdAt/updatedAt (v.number()). Index: by_user_id, by_status.\n- papers: userId, collectionId (v.optional(v.id('collections'))), externalId (v.string(), indexed), source (v.union('pubmed'|'semantic-scholar'|'openalex'|'uploaded')), title, authors (v.array(v.string())), journal (v.optional(v.string())), year (v.optional(v.number())), abstract (v.optional(v.string())), doi (v.optional(v.string())), url (v.optional(v.string())), pdfFileId (v.optional(v.id('_storage'))), isOpenAccess (v.boolean()), metadata (v.optional(v.any())), timestamps. Index: by_user_id, by_external_id, by_collection_id.\n- collections: userId, name (v.string()), description (v.optional(v.string())), timestamps. Index: by_user_id.\n- citations: documentId (v.id('documents'), indexed), paperId (v.id('papers')), sectionName (v.optional(v.string())), position (v.number()), citationText (v.string()). Index: by_document_id.\n- plagiarismChecks: userId, documentId (v.optional(v.id('documents'))), inputText (v.string()), wordCount (v.number()), overallSimilarity (v.optional(v.number())), sources (v.optional(v.any())), copyleaksScanId (v.optional(v.string())), status (v.union('pending'|'completed'|'failed')), timestamps. Index: by_user_id, by_status.\n- aiDetectionChecks: same structure as plagiarismChecks but overallAiScore (v.optional(v.number())) and sentenceResults (v.optional(v.any())). Index: by_user_id, by_status.\n- deepResearchReports: userId, topic (v.string()), report (v.optional(v.string())), citedPapers (v.optional(v.any())), status (v.union('pending'|'completed'|'failed')), timestamps. Index: by_user_id, by_status.\n- learnModeSessions: userId, documentId, currentStage (v.union('understand'|'literature'|'outline'|'drafting'|'feedback')), conversationHistory (v.optional(v.any())), feedbackGiven (v.optional(v.any())), timestamps. Index: by_user_id, by_document_id.\n- subscriptions: userId, razorpaySubscriptionId (v.optional(v.string())), planType (v.union('free'|'basic'|'pro')), status (v.union('active'|'cancelled'|'past_due')), currentPeriodStart (v.optional(v.number())), currentPeriodEnd (v.optional(v.number())), timestamps. Index: by_user_id, by_status.\n\nAlso update users table to add: institution (v.optional(v.string())), specialization (v.optional(v.string())), subscriptionStatus (v.union('none'|'active'|'cancelled'|'past_due')), subscriptionExpiry (v.optional(v.number())), razorpayCustomerId (v.optional(v.string())), plagiarismChecksUsed (v.number(), default 0), aiDetectionChecksUsed (v.number(), default 0), deepResearchUsed (v.number(), default 0).",
            "status": "done",
            "testStrategy": "Run `npx convex dev` and verify schema compilation succeeds with zero errors. Check that all 10 tables are visible in Convex dashboard. Verify indexes are created (check by_user_id, by_document_id, by_status, by_external_id, by_collection_id indexes). Use Convex dashboard to manually insert a test record in each table and verify field types are enforced.",
            "updatedAt": "2026-02-07T03:01:36.959Z",
            "parentId": "undefined"
          },
          {
            "id": 2,
            "title": "Create CRUD mutations and queries for documents table",
            "description": "Implement Convex functions for creating, reading, updating, deleting, and listing documents. Support filtering by mode, status, userId, and sorting by updatedAt.",
            "dependencies": [
              1
            ],
            "details": "Create convex/documents.ts with:\n- Mutation createDocument: args { title: v.string(), mode: v.union('learn'|'draft'), citationStyle: v.optional(v.string()) }. Gets authenticated user via ctx.auth.getUserIdentity(), inserts document with userId from users table lookup by clerkId, initial wordCount=0, status='draft', timestamps=Date.now(). Returns document ID.\n- Query getDocument: args { id: v.id('documents') }. Fetches document, verifies userId matches authenticated user. Returns document or throws 'Not authorized'.\n- Mutation updateDocument: args { id: v.id('documents'), title: v.optional(v.string()), content: v.optional(v.any()), wordCount: v.optional(v.number()), currentStage: v.optional(v.string()), outlineData: v.optional(v.any()), approvedPapers: v.optional(v.array(v.string())), citationStyle: v.optional(v.string()), status: v.optional(v.string()) }. Patches document with provided fields, updates updatedAt. Verifies ownership.\n- Mutation deleteDocument: args { id: v.id('documents') }. Verifies ownership, deletes document.\n- Query listDocuments: args { mode: v.optional(v.union('learn'|'draft')), status: v.optional(v.string()), limit: v.optional(v.number()) }. Gets userId from auth, queries documents table with by_user_id index, applies optional filters, orders by updatedAt descending, returns up to limit (default 20) documents.\n\nFollow existing pattern in convex/users.ts for auth checks and error handling using ConvexError.",
            "status": "done",
            "testStrategy": "Unit tests via Convex testing tools: (1) createDocument as authenticated user, verify document created with correct userId and defaults. (2) getDocument returns correct document for owner, throws error for non-owner. (3) updateDocument modifies fields and updates updatedAt. (4) deleteDocument removes document. (5) listDocuments returns only user's documents, respects mode/status filters. Playwright E2E: Create document via UI, verify appears in dashboard recent drafts list.",
            "parentId": "undefined",
            "updatedAt": "2026-02-07T03:02:37.590Z"
          },
          {
            "id": 3,
            "title": "Create CRUD mutations and queries for papers and collections tables",
            "description": "Implement Convex functions for managing the personal paper library (papers table) and collections/folders (collections table) with relationship handling.",
            "dependencies": [
              1
            ],
            "details": "Create convex/papers.ts with:\n- Mutation createPaper: args { externalId: v.string(), source: v.string(), title: v.string(), authors: v.array(v.string()), journal: v.optional(v.string()), year: v.optional(v.number()), abstract: v.optional(v.string()), doi: v.optional(v.string()), url: v.optional(v.string()), isOpenAccess: v.boolean(), metadata: v.optional(v.any()), collectionId: v.optional(v.id('collections')) }. Gets userId from auth, checks if paper with same externalId already exists for user (to prevent duplicates), inserts paper. Enforces free tier limit (50 papers max - check count before insert).\n- Query getPaper: args { id: v.id('papers') }. Verifies ownership, returns paper.\n- Mutation updatePaper: args { id: v.id('papers'), collectionId: v.optional(v.id('collections')), pdfFileId: v.optional(v.id('_storage')) }. For moving papers to collections or attaching PDFs.\n- Mutation deletePaper: args { id: v.id('papers') }. Verifies ownership, also deletes related citations (query citations by_document_id, delete all).\n- Query listPapers: args { collectionId: v.optional(v.id('collections')), limit: v.optional(v.number()) }. Returns user's papers, optionally filtered by collection, sorted by createdAt descending.\n\nCreate convex/collections.ts with:\n- Mutation createCollection: args { name: v.string(), description: v.optional(v.string()) }. Inserts collection with userId.\n- Query listCollections: args {}. Returns all user's collections sorted by name.\n- Mutation updateCollection: args { id: v.id('collections'), name: v.optional(v.string()), description: v.optional(v.string()) }.\n- Mutation deleteCollection: args { id: v.id('collections') }. Before deleting, set collectionId=null for all papers in this collection.\n\nUse ConvexError for ownership checks and limit enforcement.",
            "status": "done",
            "testStrategy": "Unit tests: (1) createPaper adds paper, prevents duplicate externalId. (2) Free tier user with 50 papers cannot add 51st (throws limit error). (3) updatePaper moves paper to collection. (4) deletePaper also deletes related citations. (5) listPapers filters by collection correctly. (6) createCollection/listCollections/deleteCollection work. (7) Deleting collection nullifies papers' collectionId. Playwright E2E: Save paper from search, verify in library. Create collection, move paper to collection, verify appears under collection.",
            "parentId": "undefined",
            "updatedAt": "2026-02-07T03:03:43.192Z"
          },
          {
            "id": 4,
            "title": "Implement Convex file storage for PDF uploads and helper functions",
            "description": "Set up Convex file storage configuration for PDF uploads, create mutations for uploading/retrieving PDFs, and implement helper functions for subscription tier checking and usage limit enforcement.",
            "dependencies": [
              1
            ],
            "details": "Convex file storage setup (no config file needed - built-in):\n- Create convex/files.ts with:\n  - Mutation generateUploadUrl: args {}. Returns ctx.storage.generateUploadUrl() for client-side PDF upload (max 50MB).\n  - Mutation savePdfMetadata: args { storageId: v.id('_storage'), paperId: v.id('papers') }. After client uploads PDF, this mutation links storageId to paper record by updating paper.pdfFileId.\n  - Query getFileUrl: args { storageId: v.id('_storage') }. Returns ctx.storage.getUrl(storageId) for viewing/downloading PDF.\n\nCreate convex/helpers.ts with:\n- Function getUserTier: args { userId: v.id('users') }. Queries users table and subscriptions table, returns tier ('free'|'basic'|'pro') based on subscriptionStatus and subscriptionExpiry. If subscription expired, returns 'free'.\n- Function checkPlagiarismLimit: args { userId: v.id('users') }. Gets tier, checks plagiarismChecksUsed vs limits (free:2, basic:5, pro:20). Returns { allowed: boolean, remaining: number }.\n- Function checkAiDetectionLimit: args { userId: v.id('users') }. Same logic for aiDetectionChecksUsed (free:2, basic:10, pro:unlimited).\n- Function checkDeepResearchLimit: args { userId: v.id('users') }. Same logic for deepResearchUsed (free:0, basic:5, pro:15).\n- Function incrementUsage: args { userId: v.id('users'), type: v.union('plagiarism'|'ai_detection'|'deep_research') }. Increments appropriate counter in users table.\n- Function resetMonthlyUsage: args {}. Scheduled function (runs monthly) to reset all checksUsed counters to 0 for all users.\n\nAll helpers use internal mutations/queries (internalMutation, internalQuery) for use within other Convex functions.",
            "status": "done",
            "testStrategy": "Unit tests: (1) generateUploadUrl returns valid URL. (2) savePdfMetadata links storageId to paper. (3) getFileUrl returns accessible URL. (4) getUserTier correctly identifies tier based on subscription. (5) checkPlagiarismLimit enforces limits (free user with 2 checks cannot do 3rd). (6) incrementUsage increases counter. (7) resetMonthlyUsage zeros out all counters. Playwright E2E: Upload PDF from library UI, verify file stored and viewable. Test with 51MB file, verify rejected (max 50MB).",
            "parentId": "undefined",
            "updatedAt": "2026-02-07T03:04:32.926Z"
          },
          {
            "id": 5,
            "title": "Create CRUD mutations and queries for remaining tables (citations, checks, reports, sessions, subscriptions)",
            "description": "Implement Convex functions for the final 5 tables: citations (for bibliography), plagiarismChecks, aiDetectionChecks, deepResearchReports, learnModeSessions, and subscriptions with proper usage tracking integration.",
            "dependencies": [
              1,
              4
            ],
            "details": "Create convex/citations.ts:\n- Mutation createCitation: args { documentId, paperId, sectionName, position, citationText }. Inserts citation, verifies user owns both document and paper.\n- Query listCitations: args { documentId }. Returns all citations for document, ordered by position, joins with papers table to include paper metadata for bibliography generation.\n- Mutation deleteCitation: args { id: v.id('citations') }. Verifies ownership via document lookup.\n\nCreate convex/plagiarismChecks.ts:\n- Mutation createCheck: args { documentId (optional), inputText, wordCount }. Uses checkPlagiarismLimit helper first. Gets userId, inserts with status='pending', incrementUsage('plagiarism'). Returns check ID.\n- Mutation updateCheckResults: args { id, overallSimilarity, sources, copyleaksScanId, status }. Updates check with Copyleaks results.\n- Query getCheck: args { id }. Verifies ownership.\n- Query listChecks: args { limit }. Returns user's checks sorted by createdAt descending.\n\nCreate convex/aiDetectionChecks.ts: Same structure as plagiarismChecks but with overallAiScore and sentenceResults fields.\n\nCreate convex/deepResearchReports.ts:\n- Mutation createReport: args { topic }. Uses checkDeepResearchLimit, inserts with status='pending', incrementUsage('deep_research').\n- Mutation updateReport: args { id, report, citedPapers, status }.\n- Query getReport/listReports: Standard ownership-verified queries.\n\nCreate convex/learnModeSessions.ts:\n- Mutation createSession: args { documentId }. Inserts with currentStage='understand', empty conversationHistory/feedbackGiven.\n- Mutation updateSession: args { id, currentStage, conversationHistory, feedbackGiven }. For persisting workflow state.\n- Query getSessionByDocument: args { documentId }. Returns active session for document.\n\nCreate convex/subscriptions.ts:\n- Mutation createSubscription: args { razorpaySubscriptionId, planType, currentPeriodStart, currentPeriodEnd }. Updates users table subscriptionStatus='active', subscriptionExpiry=currentPeriodEnd.\n- Mutation updateSubscriptionStatus: args { id, status }. For webhook handling (cancelled, past_due). Updates users table.\n- Query getCurrentSubscription: args {}. Gets userId, returns active subscription.\n\nAll functions use auth checks and ConvexError for unauthorized access.",
            "status": "done",
            "testStrategy": "Unit tests for each table: (1) citations: Create citation, verify joins with paper data in listCitations. (2) plagiarismChecks: createCheck enforces limits, incrementUsage called, updateCheckResults stores Copyleaks data. (3) aiDetectionChecks: same as plagiarism. (4) deepResearchReports: createReport enforces limits. (5) learnModeSessions: createSession/updateSession persist workflow state correctly. (6) subscriptions: createSubscription updates users table, updateSubscriptionStatus downgrades access when cancelled. Playwright E2E: Insert citation in editor, verify appears in citations table. Run plagiarism check (Task 10 UI), verify record created with pending status, then completed after Copyleaks returns.",
            "parentId": "undefined",
            "updatedAt": "2026-02-07T03:05:56.259Z"
          }
        ],
        "updatedAt": "2026-02-07T03:05:56.259Z"
      },
      {
        "id": "3",
        "title": "Landing Page & Dashboard UI",
        "description": "Design and implement the public landing page with hero section, feature highlights, pricing, and CTAs, plus the authenticated user dashboard showing recent drafts, quick actions, and usage statistics. Use Anthropic Frontend Design Skill (Opus) for high-quality UI design.",
        "details": "1. Use Anthropic Frontend Design Skill to design clean, Google Docs-inspired UI.\n2. Landing page (`app/page.tsx`):\n   - Hero section: Product name, tagline \"All research needs met under one single roof\", \"KhanMigo meets SciSpace\" positioning\n   - Feature highlights grid: Learn Mode, Draft Mode, Paper Search, Bibliography, Plagiarism Check, AI Detection\n   - \"Made by a doctor, for doctors\" credibility section\n   - Pricing table (Free, Basic INR 1,000/mo, Pro INR 2,000/mo future)\n   - Free plagiarism check CTA button (acquisition funnel)\n   - Sign up / Login buttons (Clerk components)\n3. Dashboard (`app/dashboard/page.tsx`, protected route):\n   - Welcome message with user's name from Clerk\n   - Quick action cards: \"Start New Paper\" (mode selector), \"Search Papers\", \"Continue Draft\"\n   - Recent drafts list (query from Convex documents table, show title, mode, status, last updated)\n   - Usage stats widget: Plagiarism checks remaining, AI detection checks remaining, subscription tier badge\n4. Responsive design: Mobile-first with Tailwind breakpoints (sm, md, lg, xl).\n5. shadcn/ui components: Button, Card, Badge, Separator.\n6. Implement mode selection dialog for \"Start New Paper\" (Learn Mode vs Draft Mode with descriptions).",
        "testStrategy": "Playwright E2E: (1) Landing page loads, all sections visible, CTA buttons clickable. (2) Sign in redirects to dashboard. (3) Dashboard shows user's name, recent drafts (after creating one), usage stats match subscription tier. (4) Test on mobile viewport (375px width). (5) Verify all touch targets ≥44px. Visual regression test with screenshots.",
        "priority": "medium",
        "dependencies": [
          "1",
          "2"
        ],
        "status": "done",
        "subtasks": [
          {
            "id": 1,
            "title": "Design landing page UI using Anthropic Frontend Design Skill with Opus",
            "description": "Use Anthropic Frontend Design Skill (Opus model) to design a clean, Google Docs-inspired landing page with hero section, feature highlights grid, credibility section, pricing table, and CTAs. Generate high-fidelity design specifications for implementation.",
            "dependencies": [],
            "details": "Invoke Frontend Design Skill with Opus model to design the landing page (`app/page.tsx`). Design requirements: (1) Hero section with 'V1 Drafts' branding, tagline 'All research needs met under one single roof', positioning 'KhanMigo meets SciSpace', primary CTA 'Start Writing for Free', secondary CTA 'Sign In'. (2) Feature highlights grid: 6 cards for Learn Mode (guided coaching), Draft Mode (AI assistance), Paper Search (multi-source), Bibliography (auto-generation), Plagiarism Check (Copyleaks), AI Detection (authenticity). Each card should have icon, title, 2-sentence description. (3) 'Made by a doctor, for doctors' credibility section with brief founder story. (4) Pricing table: Free (2 plagiarism checks, 2 AI detection, Learn Mode unlimited), Basic INR 1,000/mo (5 plagiarism, 10 AI detection, 5 deep research, Draft Mode unlimited), Pro INR 2,000/mo (20 plagiarism, unlimited AI detection, 15 deep research). Highlight Basic as recommended. (5) Free plagiarism check CTA section (acquisition funnel entry point). Design should be mobile-responsive (375px to 1280px+), clean, non-overwhelming, professional academic aesthetic. Output should include component structure, Tailwind classes, spacing, typography scale, color usage from theme.",
            "status": "done",
            "testStrategy": "Manual design review: Verify design meets Google Docs simplicity aesthetic, professional academic feel. Check mobile responsiveness at 375px, 768px, 1280px viewports. Ensure all required sections present: hero, features grid (6 cards), credibility, pricing (3 tiers), free plagiarism CTA. Verify CTA buttons have min 44px touch targets.",
            "parentId": "undefined",
            "updatedAt": "2026-02-07T04:02:01.579Z"
          },
          {
            "id": 2,
            "title": "Implement landing page with feature highlights, pricing, and CTAs",
            "description": "Implement the landing page at `app/page.tsx` based on Frontend Design Skill output. Include hero section, feature highlights grid, credibility section, pricing table, and sign-up CTAs using shadcn/ui components.",
            "dependencies": [
              1
            ],
            "details": "Implement `app/page.tsx` following the design from subtask 1. (1) Install missing shadcn/ui components if needed: `npx shadcn@latest add card badge separator`. (2) Structure: Header with logo + Sign In/Get Started buttons, Hero section (h1 tagline, subtitle, 2 CTAs), Features grid (6 Card components in 2-col mobile, 3-col tablet, 3-col desktop grid), Credibility section (centered, 'Made by a doctor, for doctors' headline + 2-3 paragraph story), Pricing section (3 Card components with Badge for 'Recommended' on Basic plan, feature lists, pricing in INR, CTA buttons), Free Plagiarism CTA section (highlighted box with CTA button), Footer (branding + 'KhanMigo meets SciSpace' tagline). (3) Use Tailwind responsive classes (sm:, md:, lg:, xl:). (4) Clerk components for Sign In/Sign Up buttons: `<SignInButton>` and `<SignUpButton>` from `@clerk/nextjs`. (5) All CTAs should navigate appropriately: 'Start Writing for Free' → /sign-up, 'Sign In' → /sign-in, 'Free Plagiarism Check' → /sign-up?redirect=/plagiarism. (6) Ensure 44px min touch targets for mobile. (7) Use semantic HTML (header, main, section, footer).",
            "status": "done",
            "testStrategy": "Playwright E2E: (1) Navigate to '/', verify page loads without errors. (2) Check hero section visible with correct tagline 'All research needs met under one single roof'. (3) Verify 6 feature cards present (Learn Mode, Draft Mode, Paper Search, Bibliography, Plagiarism Check, AI Detection). (4) Verify pricing table shows 3 plans (Free, Basic INR 1,000/mo, Pro INR 2,000/mo) with Basic marked 'Recommended'. (5) Click 'Start Writing for Free' button, verify redirects to /sign-up. (6) Click 'Sign In' button, verify redirects to /sign-in. (7) Resize viewport to 375px width, verify mobile layout (stacked cards, readable text, touch targets ≥44px). (8) Verify footer shows 'KhanMigo meets SciSpace'.",
            "parentId": "undefined",
            "updatedAt": "2026-02-07T04:02:05.278Z"
          },
          {
            "id": 3,
            "title": "Design dashboard UI using Anthropic Frontend Design Skill with Opus",
            "description": "Use Anthropic Frontend Design Skill (Opus model) to design the authenticated dashboard UI with welcome message, quick action cards, recent drafts list, and usage statistics widget. Generate design specifications for clean, focused workspace.",
            "dependencies": [],
            "details": "Invoke Frontend Design Skill with Opus model to design the dashboard page (`app/(protected)/dashboard/page.tsx`). Design requirements: (1) Welcome section: Personalized greeting 'Welcome, [User Name]', subtitle 'Your research workspace is ready'. (2) Quick action cards section: 3 prominent cards - 'Start New Paper' (opens mode selection dialog), 'Search Papers' (navigates to /search), 'Continue Draft' (shows recent drafts or disabled if none). Each card should have icon, title, description, and be clickable. (3) Recent drafts section: Title 'Recent Drafts', list/grid view of documents from Convex (max 5 shown), each item shows paper title, mode badge (Learn/Draft Guided/Draft Hands-off), status badge (In Progress/Completed/Archived), last updated timestamp, clicking opens editor. Empty state: 'No drafts yet. Start your first paper!' with CTA. (4) Usage statistics widget: Card showing subscription tier badge (Free/Basic/Pro), usage bars for plagiarism checks (X/Y used), AI detection checks (X/Y used), deep research reports (X/Y used). Show 'Unlimited' for -1 limits. Include 'Upgrade' button for Free tier users. (5) Layout: Welcome + Quick Actions at top, Recent Drafts (2/3 width) + Usage Stats (1/3 width) below in desktop, stacked on mobile. Design should feel spacious, Google Docs-inspired, professional. Provide component structure, Tailwind classes, spacing.",
            "status": "done",
            "testStrategy": "Manual design review: Verify dashboard feels clean, spacious, not overwhelming. Check mobile responsive layout (stacked sections). Ensure quick action cards are prominent and intuitive. Verify usage widget clearly shows limits with visual indicators (progress bars or fraction display). Check empty state design for recent drafts.",
            "parentId": "undefined",
            "updatedAt": "2026-02-07T04:02:08.081Z"
          },
          {
            "id": 4,
            "title": "Implement dashboard with recent drafts, quick actions, and usage stats",
            "description": "Implement the dashboard page at `app/(protected)/dashboard/page.tsx` based on Frontend Design Skill output. Integrate Convex queries for user data, documents list, and usage statistics. Include mode selection dialog component.",
            "dependencies": [
              3
            ],
            "details": "Implement `app/(protected)/dashboard/page.tsx` following design from subtask 3. (1) Install missing shadcn/ui components if needed: `npx shadcn@latest add dialog progress`. (2) Fetch data using Convex queries: `useQuery(api.users.getCurrent)` for user info, `useQuery(api.documents.list, {})` for recent drafts (limit to 5 most recent, sort by updatedAt desc), calculate usage from user object fields (plagiarismChecksUsed, aiDetectionChecksUsed, deepResearchUsed) and compare against `SUBSCRIPTION_LIMITS[user.subscriptionTier]`. (3) Welcome section: Display user.name or 'Researcher' fallback. (4) Quick action cards: 3 Card components with icons (use lucide-react: FileText, Search, FileEdit). 'Start New Paper' onClick opens mode selection Dialog. 'Search Papers' links to /search. 'Continue Draft' links to most recent draft /editor/[docId] or disabled if no drafts. (5) Recent drafts: Map over documents array, render Card for each with title (link to /editor/[docId]), mode Badge (color-coded: Learn=blue, Draft Guided=green, Draft Hands-off=purple), status Badge (In Progress=yellow, Completed=green, Archived=gray), relative timestamp (use date-fns or similar). Empty state if documents.length === 0. (6) Usage stats widget: Card with subscription tier Badge at top, 3 Progress bars for each feature with label 'Plagiarism Checks: X/Y' (or 'Unlimited' if limit=-1), 'Upgrade' Button if tier='free' links to /pricing. (7) Mode selection Dialog: Opens on 'Start New Paper' click, shows 2 radio options: 'Learn Mode' (description: 'Guided coaching, step-by-step feedback, learn research writing'), 'Draft Mode' (description: 'AI-assisted writing, faster drafting, autonomous help'). Submit creates document via `useMutation(api.documents.create)` with selected mode, then navigates to /editor/[newDocId].",
            "status": "done",
            "testStrategy": "Playwright E2E: (1) Sign in as test user, navigate to /dashboard. (2) Verify welcome message shows 'Welcome, [User's Name]' (user.name from Clerk). (3) Verify 3 quick action cards present: 'Start New Paper', 'Search Papers', 'Continue Draft'. (4) Click 'Start New Paper', verify mode selection dialog opens with Learn Mode and Draft Mode options. (5) Select Learn Mode, enter title 'Test Paper', submit, verify redirects to /editor/[docId] and document created in Convex. (6) Return to dashboard, verify 'Test Paper' appears in Recent Drafts with 'Learn' mode badge and 'In Progress' status badge. (7) Verify usage stats widget shows subscription tier badge (e.g., 'Free') and usage numbers (e.g., 'Plagiarism Checks: 0/2', 'AI Detection: 0/2'). (8) If Free tier, verify 'Upgrade' button present. (9) Test on mobile viewport (375px), verify layout stacks correctly (welcome, quick actions, recent drafts, usage stats in single column).",
            "parentId": "undefined",
            "updatedAt": "2026-02-07T04:02:11.054Z"
          },
          {
            "id": 5,
            "title": "Add Playwright E2E tests for landing page and dashboard",
            "description": "Write comprehensive Playwright E2E tests covering landing page sections, navigation, CTAs, dashboard functionality, mode selection, recent drafts display, and usage statistics. Include mobile viewport tests.",
            "dependencies": [
              2,
              4
            ],
            "details": "Create Playwright test file `tests/e2e/landing-and-dashboard.spec.ts`. (1) Landing page tests: Test 'Landing page loads and displays all sections' - navigate to '/', expect hero section with tagline visible, expect 6 feature cards present (check for text 'Learn Mode', 'Draft Mode', 'Paper Search', 'Bibliography', 'Plagiarism Check', 'AI Detection'), expect credibility section with 'Made by a doctor, for doctors', expect pricing table with 3 plans (Free, Basic, Pro), expect pricing shows 'INR 1,000' for Basic, expect 'Recommended' badge on Basic plan, expect free plagiarism CTA section. Test 'Landing page CTAs navigate correctly' - click 'Start Writing for Free' button, expect URL to be /sign-up, go back, click 'Sign In' button, expect URL to be /sign-in. Test 'Landing page is mobile responsive' - set viewport to 375x667, navigate to '/', verify all sections visible, verify touch targets ≥44px (check button heights). (2) Dashboard tests: Test 'Dashboard loads and shows user data' - sign in programmatically (use Playwright Clerk helpers or test user tokens), navigate to /dashboard, expect welcome message to contain user's name, expect quick action cards present (3 cards). Test 'Mode selection dialog works' - click 'Start New Paper' button, expect dialog to be visible, expect 2 options (Learn Mode, Draft Mode), select Learn Mode, fill in title 'E2E Test Paper', submit, expect URL to match /editor/*, expect document created in Convex (verify via API query). Test 'Recent drafts display correctly' - create test document via Convex mutation, refresh dashboard, expect recent drafts section to show 1 document, expect document title 'E2E Test Paper', expect mode badge 'Learn', expect status badge 'In Progress', expect last updated timestamp. Test 'Usage stats widget displays correctly' - expect usage stats card visible, expect subscription tier badge (e.g., 'Free'), expect usage text for plagiarism checks (e.g., '0/2'), expect usage text for AI detection (e.g., '0/2'), expect 'Upgrade' button if Free tier. Test 'Dashboard is mobile responsive' - set viewport to 375x667, navigate to /dashboard, verify layout stacks (single column), verify all sections visible and readable. (3) Add test utilities: Helper functions for creating test users, test documents, cleaning up test data. Use Playwright's `test.beforeEach` and `test.afterEach` for setup/teardown.",
            "status": "done",
            "testStrategy": "Run `npx playwright test tests/e2e/landing-and-dashboard.spec.ts`. All tests must pass. Verify tests cover: (1) Landing page sections visibility (hero, features, credibility, pricing, CTA). (2) Landing page CTAs navigation (sign-up, sign-in). (3) Landing page mobile responsiveness (375px viewport). (4) Dashboard loads with user data (welcome, quick actions, usage stats). (5) Mode selection dialog opens and creates document. (6) Recent drafts list displays created document with correct badges. (7) Usage stats widget shows correct subscription tier and usage counts. (8) Dashboard mobile responsiveness (375px viewport, stacked layout). All tests should use proper assertions (expect statements) and wait for elements to be visible/stable before interacting. Tests should clean up created data (documents) after completion.",
            "parentId": "undefined",
            "updatedAt": "2026-02-07T04:11:39.777Z"
          }
        ],
        "updatedAt": "2026-02-07T04:11:39.777Z"
      },
      {
        "id": "4",
        "title": "Multi-Source Paper Search Integration",
        "description": "Implement unified paper search interface querying PubMed E-utilities, Semantic Scholar, and OpenAlex APIs simultaneously. Include deduplication, filtering (year, study type, open access), sorting, and 'Save to Library' functionality.",
        "details": "1. Create API route handlers:\n   - `app/api/search/pubmed/route.ts`: Integrate NCBI E-utilities API (esearch + esummary). Use NCBI API key from env.\n   - `app/api/search/semantic-scholar/route.ts`: Integrate Semantic Scholar API. Use API key from env.\n   - `app/api/search/openalex/route.ts`: Integrate OpenAlex API (polite pool with email header, no key required).\n2. Create unified search endpoint `app/api/search/route.ts` that:\n   - Calls all three APIs in parallel (Promise.all)\n   - Deduplicates results by DOI, PubMed ID, or title similarity (Levenshtein distance)\n   - Merges metadata (prefer PubMed for medical papers, Semantic Scholar for citation counts)\n   - Returns standardized result format: { externalId, source, title, authors, journal, year, abstract, doi, url, isOpenAccess, citationCount }\n3. Implement search UI (`app/search/page.tsx`):\n   - PubMed-like search bar with search button\n   - Filters: Year range (from/to), study type dropdown, open access toggle, human studies only checkbox\n   - Sort dropdown: Relevance, Newest first, Citation count\n   - Results list: Paper cards with title, authors, journal, year, abstract preview (150 chars), open access badge, citation count\n   - \"Save to Library\" button per result (Convex mutation to papers table)\n   - \"View Full Abstract\" expandable section\n   - \"Find Related\" button (using Semantic Scholar recommendations API)\n4. Implement pagination (20 results per page).\n5. Loading states and error handling (graceful degradation if one API fails).\n6. Rate limiting consideration: Cache results for identical queries for 1 hour.",
        "testStrategy": "Playwright E2E: (1) Search for 'laparoscopic appendectomy', verify results from all three sources appear. (2) Apply filter 'Year: 2020-2024', verify results filtered. (3) Toggle 'Open Access Only', verify badge appears on all results. (4) Click 'Save to Library', verify paper saved in Convex papers table. (5) Test error handling by mocking API failure. (6) Test deduplication with known duplicate papers. Unit tests: Deduplication logic, result merging.",
        "priority": "high",
        "dependencies": [
          "2"
        ],
        "status": "done",
        "subtasks": [
          {
            "id": 1,
            "title": "Create Individual API Route Handlers for PubMed, Semantic Scholar, and OpenAlex",
            "description": "Build three separate Next.js API route handlers to integrate with PubMed E-utilities (esearch + esummary), Semantic Scholar API, and OpenAlex API. Each route should handle query parameters, API authentication, rate limiting, and return standardized paper metadata.",
            "dependencies": [],
            "details": "Implement `app/api/search/pubmed/route.ts` using NCBI E-utilities (esearch for search, esummary for metadata). Add NCBI_API_KEY to .env.local. Implement `app/api/search/semantic-scholar/route.ts` with API key authentication (SEMANTIC_SCHOLAR_API_KEY in env). Implement `app/api/search/openalex/route.ts` with polite pool header (mailto email, no key required). Each handler should accept query params: q (query string), yearFrom, yearTo, studyType, openAccessOnly, humanOnly. Return standardized format: { externalId, source, title, authors: string[], journal, year, abstract, doi, url, isOpenAccess, citationCount, metadata }. Install axios or use native fetch. Implement error handling with try-catch, return 200 with error flag on API failure for graceful degradation.",
            "status": "pending",
            "testStrategy": "Unit test each route handler with mock queries. Verify PubMed returns results with PMIDs. Verify Semantic Scholar returns citation counts. Verify OpenAlex respects open access filter. Test error handling when API is unavailable.",
            "parentId": "undefined"
          },
          {
            "id": 2,
            "title": "Build Unified Search Endpoint with Parallel API Calls and Deduplication",
            "description": "Create the main search aggregation endpoint that calls all three APIs in parallel, merges results, deduplicates by DOI/PMID/title similarity, and returns unified standardized results with caching.",
            "dependencies": [
              1
            ],
            "details": "Implement `app/api/search/route.ts` as the unified endpoint. Use Promise.allSettled to call pubmed, semantic-scholar, and openalex routes in parallel. Handle partial failures gracefully (if one API fails, still return results from others). Implement deduplication algorithm: (1) Match by DOI if present, (2) Match by PubMed ID if present, (3) Use Levenshtein distance on titles (threshold: 85% similarity) for fuzzy matching. Merge metadata: prefer PubMed metadata for medical papers, prefer Semantic Scholar for citation counts, use OpenAlex for open access status. Install fast-levenshtein npm package for string similarity. Implement in-memory cache (Map) for identical queries with 1-hour TTL. Return format: { results: Paper[], sources: { pubmed: number, semanticScholar: number, openalex: number }, cached: boolean, errors: string[] }. Apply filters (year range, study type, open access, human studies) post-merge if not supported by individual APIs.",
            "status": "pending",
            "testStrategy": "Playwright E2E: Search for 'laparoscopic appendectomy', verify results from all three sources appear with merged metadata. Test deduplication by searching query with known duplicates across sources. Test cache by running identical query twice, verify second response is cached. Test graceful degradation by mocking one API failure.",
            "parentId": "undefined"
          },
          {
            "id": 3,
            "title": "Implement Search UI with Filters, Sorting, and Results Display",
            "description": "Build the search page UI with PubMed-like search bar, advanced filters (year range, study type, open access, human studies), sort options, and responsive results list with paper cards showing metadata and expandable abstracts.",
            "dependencies": [
              2
            ],
            "details": "Create `app/search/page.tsx` as a client component ('use client'). UI components: (1) Search bar using shadcn/ui Input + Button, (2) Filter panel with: Year range (two Number inputs for from/to), Study type dropdown (Select component: Clinical Trial, Meta-Analysis, Randomized Controlled Trial, Review, Observational Study), Open Access toggle (Switch component), Human Studies checkbox. (3) Sort dropdown (Select: Relevance, Newest First, Citation Count). (4) Results section: Display paper cards using shadcn/ui Card component. Each card shows: title (bold), authors (comma-separated, max 3 + 'et al.'), journal + year, abstract preview (150 chars with '...' truncation), Open Access badge (shadcn/ui Badge if isOpenAccess), citation count display, 'View Full Abstract' expandable section (Collapsible component), 'Save to Library' button (calls Convex papers.save mutation), 'Find Related' button (calls Semantic Scholar recommendations API). Use React state for filters, query, results. Implement loading state (Skeleton components) and empty state ('No results found'). Mobile responsive: stack filters vertically on <768px, single column results. Use Tailwind for spacing and layout.",
            "status": "pending",
            "testStrategy": "Playwright E2E: (1) Enter search query, click search, verify results render. (2) Apply year filter 2020-2024, verify filtered results. (3) Toggle 'Open Access Only', verify all results show OA badge. (4) Change sort to 'Newest First', verify results reorder. (5) Click 'View Full Abstract', verify abstract expands. (6) Verify mobile responsive at 375px viewport.",
            "parentId": "undefined"
          },
          {
            "id": 4,
            "title": "Implement Save to Library Functionality with Convex Integration",
            "description": "Add 'Save to Library' button functionality that saves selected papers to the user's Convex papers table, with duplicate detection, success/error feedback, and saved state indication.",
            "dependencies": [
              3
            ],
            "details": "In search page, import Convex useMutation and useQuery hooks. Use papers.save mutation from convex/papers.ts (already implemented). On 'Save to Library' button click: (1) Call mutation with paper data (externalId, source, title, authors, journal, year, abstract, doi, url, isOpenAccess, metadata), (2) Handle success: show success toast (install sonner npm for toast notifications), disable button and show 'Saved' state. (3) Handle error: show error toast with message. Use papers.getByExternalId query to check if paper already saved on initial load, pre-mark buttons as 'Saved' if true. Button states: 'Save to Library' (default), 'Saving...' (loading), 'Saved ✓' (saved). Use shadcn/ui Button variant 'outline' for save button, 'ghost' for saved state. Implement optimistic UI update (immediately mark as saved, revert on error). Add optional collectionId param to save directly to a collection (for future library feature).",
            "status": "pending",
            "testStrategy": "Playwright E2E: (1) Search for paper, click 'Save to Library', verify success toast appears and button shows 'Saved ✓'. (2) Reload page, search same query, verify button already shows 'Saved' state. (3) Try saving duplicate, verify mutation returns existing paper ID (no duplicate created). (4) Verify saved paper appears in Convex papers table with correct userId.",
            "parentId": "undefined"
          },
          {
            "id": 5,
            "title": "Implement Pagination, Related Papers, and Rate Limiting",
            "description": "Add pagination (20 results per page) with page controls, implement 'Find Related' functionality using Semantic Scholar recommendations API, and add client-side rate limiting to prevent API abuse.",
            "dependencies": [
              3,
              4
            ],
            "details": "Pagination: Modify unified search endpoint to accept page param (default 1) and return paginated results (20 per page). Add totalResults count to response. In search UI, add pagination controls using shadcn/ui Button components: Previous, page numbers (show current ± 2), Next. Update URL query params on page change for shareable links (use next/navigation useRouter and searchParams). 'Find Related' button: Create `app/api/search/related/route.ts` that calls Semantic Scholar recommendations API endpoint `/recommendations/v1/papers/forpaper/{paper_id}`. Accept paperId (Semantic Scholar ID or DOI) as param, return same standardized format. In UI, clicking 'Find Related' opens new search results with related papers. Rate limiting: Implement client-side debounce on search input (300ms) to prevent excessive API calls. Add request throttling on API routes using simple in-memory counter (max 60 requests per minute per IP). If rate limit exceeded, return 429 status with retry-after header. Loading states: Show skeleton loader during pagination. Scroll to top on page change.",
            "status": "pending",
            "testStrategy": "Playwright E2E: (1) Search query with >20 results, verify pagination controls appear. (2) Click page 2, verify next 20 results load and URL updates. (3) Click 'Find Related' on a paper, verify related papers load in new results view. (4) Test rate limiting by making 61 rapid requests, verify 429 response on 61st. (5) Test debounce by typing quickly, verify only one API call after 300ms pause.",
            "parentId": "undefined"
          }
        ],
        "updatedAt": "2026-02-07T05:51:16.016Z"
      },
      {
        "id": "5",
        "title": "Personal Paper Library & PDF Management",
        "description": "Build the personal library interface for saving, organizing, and managing research papers. Support collections/folders, PDF uploads to Convex file storage, metadata display, and in-app PDF viewing using PDF.js.",
        "details": "1. Library UI (`app/library/page.tsx`):\n   - Left sidebar: Collections list (Convex query from collections table), \"New Collection\" button\n   - Main area: Paper grid/list view with metadata cards\n   - Top bar: Upload PDF button, sort dropdown (Date added, Date published, Alphabetical, Journal), search within library input\n2. Collections CRUD:\n   - Create collection: Modal with name + optional description (Convex mutation)\n   - Rename/delete collection (Convex mutations)\n   - Drag-and-drop papers into collections (update paper.collectionId)\n3. PDF upload:\n   - File input (accept=\".pdf\", max 50MB)\n   - Upload to Convex file storage using `storage.store(file)`\n   - Extract metadata: Parse first page for title/authors using pdf-parse npm library\n   - Create paper record in Convex with source='uploaded', pdfFileId\n4. Paper card component:\n   - Title, authors, journal, year, abstract preview\n   - Badges: Open Access, Uploaded, Collection name\n   - Quick actions: View (modal with full abstract), Download (if pdfFileId exists), Open Original (external link), Remove from Library\n5. PDF viewer modal:\n   - Integrate PDF.js (via react-pdf npm library)\n   - Basic controls: Page navigation, zoom, download\n   - Only for papers with pdfFileId (open access or uploaded)\n6. Usage limits: Free tier limited to 50 papers (check count before allowing save).\n7. Related papers feature: \"More like this\" button queries Semantic Scholar /recommendations endpoint.",
        "testStrategy": "Playwright E2E: (1) Create collection 'Thesis Chapter 1', verify appears in sidebar. (2) Save paper from search to library, verify appears in All Papers. (3) Move paper to collection, verify appears under collection. (4) Upload test PDF, verify upload succeeds, metadata extracted, viewable in PDF viewer. (5) Test 50-paper limit for free tier (mock user with 50 papers, verify save blocked). (6) Search within library works. (7) Related papers button returns recommendations.",
        "priority": "medium",
        "dependencies": [
          "2",
          "4"
        ],
        "status": "done",
        "subtasks": [
          {
            "id": 1,
            "title": "Build Library Page UI with Collections Sidebar",
            "description": "Create the main library interface at app/library/page.tsx with a left sidebar showing collections, main paper grid/list view, and top toolbar with upload, sort, and search functionality.",
            "dependencies": [],
            "details": "Use Anthropic Frontend Design Skill with Opus model to design the library UI following Google Docs simplicity. Create app/(protected)/library/page.tsx with: (1) Left sidebar using Sheet/Dialog component for mobile, displaying collections from convex/collections.list query, 'All Papers' default view, and 'New Collection' button. (2) Main area with paper grid (card layout) using existing Card component from shadcn/ui. (3) Top toolbar with Upload PDF button, sort dropdown (Date Added, Date Published, Alphabetical, Journal), and search input for filtering within library. (4) Use convex/papers.list query to fetch papers, filter by collectionId when collection selected. (5) Implement responsive design (mobile-first, 375px to 1280px). (6) Empty states for no papers and no collections.",
            "status": "done",
            "testStrategy": "Playwright E2E: (1) Navigate to /library, verify page renders with sidebar and empty state. (2) Verify collections list loads from Convex. (3) Test responsive behavior on 375px and 1280px viewports. (4) Verify All Papers view shows all user papers.",
            "parentId": "undefined",
            "updatedAt": "2026-02-07T06:01:37.752Z"
          },
          {
            "id": 2,
            "title": "Implement Collections Management (Create/Rename/Delete)",
            "description": "Build collection management modals and functionality using existing Convex mutations (create, update, remove) with proper UI feedback and drag-and-drop support for organizing papers.",
            "dependencies": [
              1
            ],
            "details": "Create components/library/collection-dialog.tsx for create/edit using Dialog component from shadcn/ui with form inputs (name, optional description). Wire up to convex/collections.create and convex/collections.update mutations. Create components/library/collection-item.tsx for sidebar with context menu (rename, delete actions) using DropdownMenu component. Implement delete confirmation dialog. For drag-and-drop: use HTML5 drag-and-drop API or install @dnd-kit/core library, allow dragging paper cards onto collection items in sidebar, call convex/papers.update mutation to set collectionId. Show toast notifications on success/error. Handle edge cases: prevent deleting collection with papers (or show warning), limit collection name to 50 chars.",
            "status": "done",
            "testStrategy": "Playwright E2E: (1) Create collection 'Thesis Chapter 1', verify appears in sidebar. (2) Rename collection, verify name updates. (3) Drag paper to collection, verify paper.collectionId updated in Convex. (4) Delete empty collection, verify removed. (5) Try deleting collection with papers, verify warning shown.",
            "parentId": "undefined",
            "updatedAt": "2026-02-07T06:03:54.466Z"
          },
          {
            "id": 3,
            "title": "Implement PDF Upload with Metadata Extraction",
            "description": "Build PDF upload functionality using Convex file storage, extract metadata from uploaded PDFs using pdf-parse library, and enforce 50MB file size limit with usage tier restrictions.",
            "dependencies": [
              1
            ],
            "details": "Install pdf-parse npm package. Create components/library/upload-pdf-button.tsx with file input (accept='.pdf', max 50MB validation). On file selection: (1) Validate file size client-side (max 50MB). (2) Check user's subscription tier and paper count limit (Free tier: 50 papers max - query convex/papers.list and count, use similar pattern to convex/lib/subscriptionLimits.ts). (3) Call convex/files.generateUploadUrl mutation to get upload URL. (4) Upload file to Convex storage using fetch POST. (5) Create server-side Convex mutation (convex/papers.uploadPdf.ts) that: receives storageId, uses ctx.storage.get to fetch file, uses pdf-parse to extract metadata (title from first page, authors if parseable), creates paper record with source='uploaded', pdfFileId=storageId, extracted metadata. (6) Show upload progress indicator. (7) Handle errors (file too large, tier limit reached, parse failure - use generic fallback metadata).",
            "status": "done",
            "testStrategy": "Playwright E2E: (1) Upload valid PDF <50MB, verify upload succeeds and paper appears in library. (2) Verify metadata extraction (title, authors). (3) Upload file >50MB, verify error shown. (4) Upload 51st paper on free tier, verify limit error. (5) Verify pdfFileId stored in Convex.",
            "parentId": "undefined",
            "updatedAt": "2026-02-07T06:06:07.178Z"
          },
          {
            "id": 4,
            "title": "Build Paper Card Component with Metadata and Actions",
            "description": "Create reusable paper card component displaying title, authors, journal, year, abstract preview with badges and quick action buttons (View, Download, Open Original, Remove).",
            "dependencies": [
              1
            ],
            "details": "Create components/library/paper-card.tsx using Card, Badge components from shadcn/ui. Display: (1) Title (h3, truncate to 2 lines with ellipsis). (2) Authors (joined by comma, truncate to 3 authors + 'et al'). (3) Journal name and year (muted text). (4) Abstract preview (truncate to 150 chars with '...'). (5) Badges: Open Access (green badge if isOpenAccess=true), Uploaded (blue badge if source='uploaded'), Collection name (if collectionId exists - query collection name). (6) Quick actions dropdown using DropdownMenu: View (opens abstract modal), Download (if pdfFileId exists - call convex/files.getUrl query and trigger download), Open Original (opens paper.url in new tab if exists), Remove from Library (confirmation dialog, call convex/papers.remove mutation). (7) Hover effects and responsive layout. (8) Handle missing fields gracefully (show 'N/A' for missing journal/year).",
            "status": "done",
            "testStrategy": "Playwright E2E: (1) Save paper from search, verify card displays all metadata correctly. (2) Click View, verify abstract modal opens. (3) Click Download on uploaded PDF, verify download triggers. (4) Click Open Original, verify new tab opens. (5) Click Remove, confirm, verify paper deleted. (6) Verify badges (Open Access, Uploaded, Collection) render correctly.",
            "parentId": "undefined",
            "updatedAt": "2026-02-07T06:04:20.323Z"
          },
          {
            "id": 5,
            "title": "Integrate PDF Viewer Modal with PDF.js",
            "description": "Implement in-app PDF viewing using react-pdf library with navigation controls, zoom, and download functionality for papers with stored pdfFileId.",
            "dependencies": [
              4
            ],
            "details": "Install react-pdf and pdfjs-dist npm packages. Create components/library/pdf-viewer-modal.tsx using Dialog component. Configure PDF.js worker (pdfjs.GlobalWorkerOptions.workerSrc in useEffect). Component props: paperId (to fetch pdfFileId via convex/papers.get query). On open: (1) Check if paper.pdfFileId exists, show error if not ('PDF not available'). (2) Fetch PDF URL using convex/files.getUrl query with pdfFileId. (3) Render react-pdf <Document> and <Page> components. (4) Implement controls: page navigation (prev/next buttons, page counter 'Page X of Y'), zoom controls (+/- buttons, fit-width/fit-height), download button (reuse download logic from paper card). (5) Loading state while PDF loads. (6) Error handling (PDF failed to load, corrupt file). (7) Close button. (8) Make modal full-screen on mobile, large centered modal on desktop. Only allow viewing for papers with pdfFileId (uploaded PDFs or open access with stored PDF).",
            "status": "done",
            "testStrategy": "Playwright E2E: (1) Upload PDF, click View, verify PDF viewer modal opens and renders first page. (2) Navigate to page 2, verify page changes. (3) Zoom in/out, verify zoom works. (4) Download from modal, verify download triggers. (5) Click paper without PDF, verify 'PDF not available' error. (6) Test on mobile viewport, verify full-screen mode.",
            "parentId": "undefined",
            "updatedAt": "2026-02-07T06:08:02.270Z"
          }
        ],
        "updatedAt": "2026-02-07T06:08:02.270Z"
      },
      {
        "id": "6",
        "title": "Tiptap Writing Editor with Citations & Auto-Save",
        "description": "Implement the rich text editor using Tiptap with IMRAD templates, inline citation insertion from library, auto-save to Convex, multiple draft management, word count, and AI integration panels for Learn/Draft modes.",
        "details": "1. Install Tiptap: `npm install @tiptap/react @tiptap/starter-kit @tiptap/extension-placeholder @tiptap/extension-character-count`.\n2. Editor component (`components/editor/TiptapEditor.tsx`):\n   - Extensions: StarterKit (bold, italic, headings, lists, blockquote), Placeholder, CharacterCount, custom Citation extension\n   - Toolbar: Bold, Italic, Underline, H1-H6, Bullet List, Numbered List, Blockquote, Insert Citation button\n   - Full-screen mode toggle\n   - Word count display (bottom right)\n3. IMRAD template:\n   - Pre-populate new documents with section headers: Introduction, Methods, Results, Discussion, Conclusion\n   - Each section is a H2 heading with placeholder text\n4. Auto-save:\n   - Debounced save (2 seconds after last edit) to Convex documents table\n   - Save status indicator (\"Saving...\", \"All changes saved\", timestamp)\n   - Update wordCount field on each save\n5. Citation insertion:\n   - \"Insert Citation\" button opens modal with user's library (papers from Convex)\n   - Select paper, inserts inline citation placeholder [1] or (Author, Year) depending on citationStyle\n   - Creates record in citations table linking documentId + paperId\n6. Multiple drafts:\n   - Draft selector dropdown in top bar (query user's documents from Convex)\n   - \"New Draft\" button\n   - Draft title editable inline (blur event saves to Convex)\n7. AI panels:\n   - Learn Mode: Right sidebar with chat-like interface for Socratic questions, sentence starters, examples\n   - Draft Mode: Right sidebar with workflow progress (Step 1-5), approve/reject buttons\n   - Toggle sidebar visibility\n8. Mobile responsive: Stack editor + sidebar vertically on mobile, sidebar slides over on button press.",
        "testStrategy": "Playwright E2E: (1) Create new draft, verify IMRAD template appears. (2) Type text, wait 3 seconds, verify auto-save triggered and document updated in Convex. (3) Format text (bold, italic, H2), verify formatting persists after reload. (4) Insert citation from library, verify [1] appears and citations table updated. (5) Word count updates in real-time. (6) Full-screen mode works. (7) Switch between multiple drafts. (8) Test on mobile viewport. Unit test: Auto-save debounce logic.",
        "priority": "high",
        "dependencies": [
          "2",
          "5"
        ],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": "7",
        "title": "Bibliography Generator with Citation.js",
        "description": "Integrate Citation.js to auto-generate formatted bibliographies in Vancouver, APA, AMA, and Chicago styles. Support in-text citation formatting, style switching, and bibliography export. Target major medical journals (NEJM, Lancet, JAMA).",
        "details": "1. Install Citation.js: `npm install @citation-js/core @citation-js/plugin-csl`.\n2. Fetch CSL style files for Vancouver, APA, AMA, Chicago from GitHub (Zotero style repository).\n3. Create bibliography service (`lib/bibliography.ts`):\n   - Function: generateBibliography(citations: Citation[], style: 'vancouver' | 'apa' | 'ama' | 'chicago') → string[]\n   - For each citation, fetch paper metadata from Convex papers table\n   - Convert to CSL-JSON format (title, author, issued, container-title, DOI, etc.)\n   - Use Citation.js to format according to selected style\n   - Return sorted bibliography entries\n4. In-text citation formatting:\n   - Vancouver: Numbered [1], [2,3], [4-7]\n   - APA: (Author, Year), (Author1 & Author2, Year), (Author1 et al., Year)\n   - Scan document for citation placeholders, replace with correct format based on citationStyle\n5. Bibliography section:\n   - Auto-insert \"References\" H2 at end of document\n   - Render bibliography entries below (generated from citations table)\n   - Update automatically when citations added/removed\n6. Style switcher:\n   - Dropdown in editor toolbar: Vancouver (default), APA, AMA, Chicago\n   - On change, update document.citationStyle in Convex, re-render citations and bibliography\n7. Export bibliography separately:\n   - \"Export Bibliography\" button → download .txt file with just the references\n8. Journal-specific formatting:\n   - Validate formatting against NEJM, Lancet, JAMA, JACC, Nature guidelines (unit tests with sample citations).",
        "testStrategy": "Unit tests: (1) Generate Vancouver bibliography from 10 sample papers, verify numbering and format. (2) Generate APA bibliography, verify author-year format. (3) Test edge cases: 1 author, 7+ authors (et al.), no DOI, no journal. (4) Verify NEJM compliance (Vancouver numbered, et al. for >6 authors). Playwright E2E: (1) Insert 3 citations, verify in-text [1][2][3] and bibliography auto-generated. (2) Switch to APA, verify in-text changes to (Author, Year) and bibliography reformatted. (3) Add citation, verify bibliography updates. (4) Export bibliography as .txt.",
        "priority": "medium",
        "dependencies": [
          "6"
        ],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": "8",
        "title": "Mastra Agent Framework & GLM-4.7 Integration for Draft Mode",
        "description": "Set up Mastra agent framework, integrate GLM-4.7 (Zhipu AI) as the LLM provider, implement Draft Mode Guided workflow with human-in-the-loop suspend/resume points (outline → papers → write), and Hands-Off workflow with disclaimer.",
        "details": "1. Install Mastra: `npm install @mastra/core @mastra/vercel-ai`. Mastra already supports Zhipu AI via `createZhipu` provider.\n2. Set up GLM-4.7 integration:\n   - Sign up at z.ai or bigmodel.cn, obtain API key\n   - Add ZHIPU_API_KEY to .env.local\n   - Configure Mastra client with Zhipu provider in `lib/mastra.ts`\n3. Define Draft Mode agents (`lib/agents/draftMode.ts`):\n   - OutlineAgent: Takes research topic, generates IMRAD outline with subsections. System prompt: \"You are an expert medical researcher. Generate a structured outline in IMRAD format for: [topic]. Include subsections.\"\n   - PaperFinderAgent: Takes outline section, queries paper search APIs, returns relevant papers. Integrates with search API from Task 4.\n   - WriterAgent: Takes section + approved papers, writes section with inline citations. System prompt: \"Write the [section] section using ONLY the following papers as sources: [papers]. Include numbered citations.\"\n4. Implement Guided workflow (`lib/workflows/draftModeGuided.ts`):\n   - Step 1: User inputs topic → OutlineAgent generates outline → SUSPEND → user reviews/edits outline → RESUME\n   - Step 2: For each section → PaperFinderAgent fetches papers → SUSPEND → user approves/removes papers → RESUME\n   - Step 3: For each section → WriterAgent writes section → SUSPEND → user reviews → RESUME\n   - Step 4: Combine all sections into complete draft in Tiptap editor\n   - Store workflow state in Convex documents.outlineData and documents.approvedPapers\n5. Implement Hands-Off workflow (`lib/workflows/draftModeHandsOff.ts`):\n   - Same steps, NO SUSPEND points\n   - Display disclaimer BEFORE starting and AFTER completion\n   - Disclaimer component: Modal with full text from constitution Article 5.1, require explicit acknowledgment\n6. UI for Draft Mode (`app/draft/page.tsx`):\n   - Topic input field\n   - Mode toggle: Guided vs Hands-Off\n   - Right sidebar shows workflow progress (Step 1/5, current action)\n   - Approve/Reject buttons at each suspend point\n   - Loading states with progress indicators\n7. Error handling: If LLM API fails, show graceful error, allow retry.",
        "testStrategy": "Playwright E2E: (1) Guided mode: Enter topic 'laparoscopic appendectomy', verify outline generated, edit outline, approve, verify papers fetched, approve papers, verify draft written section-by-section. (2) Hands-Off mode: Verify disclaimer shown, accept, verify complete draft generated without pauses. (3) Test workflow state persistence (refresh page mid-workflow, verify can resume). (4) Test error handling (mock GLM-4.7 API failure, verify error message). Unit tests: Each agent with mock LLM responses. Verify correct prompts sent to GLM-4.7.",
        "priority": "high",
        "dependencies": [
          "6"
        ],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": "9",
        "title": "Learn Mode Socratic Coach with Mastra Workflows",
        "description": "Implement Learn Mode 5-stage sequential workflow (Understand → Literature → Outline → Drafting → Feedback) using Mastra agents. Enforce Socratic questioning, sentence starters, examples from published papers, and structured one-at-a-time feedback. Never write complete sentences for the student.",
        "details": "1. Define Learn Mode agents (`lib/agents/learnMode.ts`):\n   - SocraticCoachAgent: Asks probing questions, provides sentence starters. System prompt: \"You are a writing coach using the Socratic method. Ask questions to guide the student, never provide direct answers. Suggest sentence starters but NEVER complete them. Example: 'You could start with: The primary objective...' then stop.\"\n   - FeedbackAgent: Provides structured feedback in 5 categories (Thesis & Focus, Evidence & Reasoning, Methodology Rigor, Structure & Organization, Language & Tone). System prompt: \"Analyze the student's text in the category: [category]. Provide ONE specific suggestion for improvement. Show an example from a published paper if relevant.\"\n2. Implement Learn Mode workflow (`lib/workflows/learnMode.ts`):\n   - Stage 1 (Understand): SocraticCoachAgent asks clarifying questions about research topic/question → SUSPEND → student responds → Agent evaluates clarity → If unclear, ask more questions → If clear, RESUME to Stage 2\n   - Stage 2 (Literature): Agent guides student on search keywords → Student uses paper search (Task 4) → Agent asks: \"Is this paper relevant? Why?\" → Student saves papers to library → Agent asks about gaps in literature → RESUME to Stage 3\n   - Stage 3 (Outline): Agent proposes IMRAD outline → SUSPEND → Student reviews/modifies → Agent asks questions about each section → Student approves → RESUME to Stage 4\n   - Stage 4 (Drafting): Student writes in editor → Agent provides sentence starters on request → Agent shows examples from published papers → Agent asks guiding questions (\"Have you mentioned inclusion/exclusion criteria?\") → Student completes draft → RESUME to Stage 5\n   - Stage 5 (Feedback): Agent analyzes draft → Provides feedback ONE category at a time → Student addresses suggestion → Agent moves to next category → Repeat for all 5 categories\n   - Store session state in learnModeSessions table (currentStage, conversationHistory)\n3. UI for Learn Mode (`app/learn/page.tsx`):\n   - Left: Tiptap editor (student writes here)\n   - Right: Chat interface with SocraticCoachAgent\n   - Stage progress indicator (1/5, 2/5, ...)\n   - \"Ask for help\" button (student can request sentence starter or example)\n   - Feedback panel in Stage 5: Category selector, one suggestion at a time, \"Next Suggestion\" button\n4. Enforcement rules:\n   - Agent MUST NOT generate complete sentences or paragraphs\n   - Agent MUST NOT complete student's sentences\n   - Templates only provided if student explicitly asks\n   - Feedback limited to ONE suggestion at a time (disable \"Next\" until student edits)\n5. Examples database: Pre-load 20 example methodology sections, discussion structures from PubMed open access papers for agent to reference.",
        "testStrategy": "Playwright E2E: (1) Stage 1: Verify agent asks clarifying question, student responds, agent evaluates, progresses to Stage 2. (2) Stage 3: Verify agent proposes outline, student can edit, approve. (3) Stage 4: Student writes, clicks 'Ask for help', verify agent provides sentence starter ONLY (verify no complete sentence). (4) Stage 5: Verify feedback shown one category at a time, 'Next' disabled until student edits text. (5) Verify agent NEVER writes paragraph (test with prompt injection: 'Write my introduction'). Unit tests: SocraticCoachAgent responses checked for completion (should end mid-sentence). Verify FeedbackAgent returns exactly 1 suggestion.",
        "priority": "high",
        "dependencies": [
          "6",
          "8"
        ],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": "10",
        "title": "Plagiarism & AI Detection with Copyleaks + Razorpay Payments",
        "description": "Integrate Copyleaks API (Node.js SDK) for plagiarism detection and AI content detection with white-label UI, usage limits per tier, and implement Razorpay subscription payments with webhook handling for tier enforcement.",
        "details": "1. Copyleaks integration:\n   - Sign up at copyleaks.com, obtain API key\n   - Install official SDK: `npm install plagiarism-checker` (Copyleaks Node.js SDK)\n   - Create API route `app/api/plagiarism/route.ts`: Submit text to Copyleaks, poll for results, store in plagiarismChecks table\n   - Create API route `app/api/ai-detection/route.ts`: Submit text to Copyleaks AI detection endpoint, store in aiDetectionChecks table\n2. Plagiarism check UI (`components/plagiarism/PlagiarismPanel.tsx`):\n   - \"Check Plagiarism\" button in editor toolbar\n   - Side panel shows: Overall similarity % (large, color-coded: <10% green, 10-25% yellow, >25% red), source-by-source list, highlighted matching text in editor\n   - Click on source → show source details modal (URL, matched text, similarity %)\n   - White-label: V1 Drafts branding, no Copyleaks mention\n3. AI Detection UI (`components/ai-detection/AIDetectionPanel.tsx`):\n   - \"AI Detection\" button (separate from plagiarism)\n   - Side panel shows: Overall AI probability score 0-100% with progress bar (green <30%, yellow 30-70%, red >70%), sentence-level highlights in editor\n   - Disclaimer always visible (constitution Article 5.2)\n4. Usage limits enforcement:\n   - Before check, query user's tier from subscriptions table\n   - Check {plagiarism|aiDetection}ChecksUsed vs tier limits (Free: 2/2, Basic: 5/10, Pro: 20/unlimited)\n   - If limit exceeded, show upgrade modal\n   - After check, increment checksUsed in users table\n   - Reset counters monthly (cron job or Convex scheduled function)\n5. Free funnel (no signup):\n   - Landing page \"Free Plagiarism Check\" button → `/plagiarism-free` page\n   - Text input (max 1000 words), submit → run check (no user record)\n   - After results, CTA: \"Sign up for 2 free checks per month + more features\"\n6. Razorpay integration:\n   - Sign up at razorpay.com, obtain API keys (test + live)\n   - Install SDK: `npm install razorpay`\n   - Create subscription plans in Razorpay dashboard: Basic (INR 1,000/month), Pro (INR 2,000/month)\n   - Pricing page (`app/pricing/page.tsx`): Feature comparison table, \"Subscribe\" buttons\n   - Payment flow: Click Subscribe → Razorpay Checkout modal → On success, webhook creates subscription record in Convex\n   - Webhook handler (`app/api/razorpay/webhook/route.ts`): Verify signature, handle events (subscription.activated, subscription.cancelled, payment.failed), update subscriptions table and users.subscriptionStatus\n7. Subscription management (`app/account/subscription/page.tsx`):\n   - Show current plan, renewal date, payment history\n   - \"Cancel Subscription\" button (calls Razorpay API)\n   - Grace period: 3 days after failed payment before access downgrade",
        "testStrategy": "Playwright E2E: (1) Free funnel: Enter 1000-word text, verify plagiarism check runs, results shown, CTA displayed. (2) Free account: Run 2 plagiarism checks, verify 3rd blocked with upgrade modal. (3) Subscribe to Basic plan (test mode), verify Razorpay modal opens, mock payment success, verify webhook creates subscription record, user tier updated to 'basic', limits increased. (4) Run plagiarism check as paid user, verify highlighted matches and sources. (5) Run AI detection, verify sentence-level scores and disclaimer shown. (6) Cancel subscription, verify status updated. (7) Mock payment failure, verify grace period starts. Unit tests: Usage limit calculations, webhook signature verification, tier enforcement logic.",
        "priority": "high",
        "dependencies": [
          "2",
          "6"
        ],
        "status": "pending",
        "subtasks": []
      }
    ],
    "metadata": {
      "version": "1.0.0",
      "lastModified": "2026-02-07T06:08:02.270Z",
      "taskCount": 10,
      "completedCount": 5,
      "tags": [
        "master"
      ]
    }
  }
}